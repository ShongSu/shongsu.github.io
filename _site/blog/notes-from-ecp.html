<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="檐下窗欞斜映枝椏 與你席地對座飲茶">
    <meta name="author" content="Pengyu">

    <title>Notes from Expert C Programming / C专家编程笔记 - A Piece of Sunshine</title>

    <link rel="canonical" href="http://localhost:4000/blog/notes-from-ecp.html">

    <!-- Icons -->
    <link rel="shortcut icon" href="/sysimg/favicon.ico">
    <link rel="apple-touch-icon" href="/sysimg/favicon.ico">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Syntax Highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400;1,700&family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;0,800;1,300;1,400;1,600;1,700;1,800&display=swap" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66863061-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-66863061-1');
    </script>
    
</head>


<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-main" aria-expanded="false" aria-label="Toggle navigation">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">A Piece of Sunshine</a>
        </div>

        <div class="collapse navbar-collapse" id="navbar-main">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                    <li>
                        <a href="/pages/about.html">About</a>
                    </li>
                    
                
                    
                    <li>
                        <a href="/pages/archives.html">Archives</a>
                    </li>
                    
                
                    
                    <li>
                        <a href="/pages/people.html">People</a>
                    </li>
                    
                
                    
                    <li>
                        <a href="/pages/projects.html">Projects</a>
                    </li>
                    
                
                    
                    <li>
                        <a href="/pages/reading.html">Reading</a>
                    </li>
                    
                
                    
                    <li>
                        <a href="/pages/tags.html">Tags</a>
                    </li>
                    
                
                    
                    <li>
                        <a href="/pages/travel.html">Travel</a>
                    </li>
                    
                
            </ul>
        </div>
    </div>
</nav>


    <!-- Post Header -->
<style type="text/css">
    header.intro-header {
        background-image: url('/sysimg/autumn2.jpg');
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    
                    <div class="Tags">
                        
                        <a class="tag" href="/tags.html#c-c" title="C/C++">C/C++</a>
                        
                    </div>
                    
                    <h1>Notes from Expert C Programming / C专家编程笔记</h1>
                    
                    <span class="meta">
                        Posted by Pengyu 
                        on May 2, 2016
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 post-container">
                <h2 id="chapter-1-c-through-the-mists-of-time">Chapter 1: C Through the Mists of Time</h2>

<h3 id="notes">Notes</h3>

<ul>
  <li>Avoid unnecessary complexity by minimizing your use of unsigned types; use a signed type like <code class="language-plaintext highlighter-rouge">int</code> and you won’t have to worry about boundary cases in the detailed rules for promoting mixed types; only use unsigned types for bitfields or binary masks. Use casts in expressions, to make all the operands <code class="language-plaintext highlighter-rouge">signed</code> or <code class="language-plaintext highlighter-rouge">unsigned</code>, so the compiler does not have to choose the result type.</li>
</ul>

<p>for example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>int array[] = { 23, 34, 12, 17, 204, 99, 16 };
#define TOTAL_ELEMENTS (sizeof(array) / sizeof(array[0]))
int main(){
</code></pre></div></div>
<p>int d= -1;
if (d &lt;= TOTAL_ELEMENTS-2)
{
  /* … */
}</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>}
</code></pre></div></div>

<p>The defined variable <code class="language-plaintext highlighter-rouge">TOTAL_ELEMENTS</code> has type <code class="language-plaintext highlighter-rouge">unsigned int</code> (because the return type of sizeof is “unsigned”). The test is comparing a signed <code class="language-plaintext highlighter-rouge">int</code> with an <code class="language-plaintext highlighter-rouge">unsigned int</code> quantity. So <code class="language-plaintext highlighter-rouge">d</code> is promoted to <code class="language-plaintext highlighter-rouge">unsigned int</code>. Interpreting -1 as an <code class="language-plaintext highlighter-rouge">unsigned int</code> yields a big positive number, making the clause <code class="language-plaintext highlighter-rouge">false</code>.</p>

<h2 id="chapter-2-its-not-a-bug-its-a-language-feature">Chapter 2: It’s Not a Bug, It’s a Language Feature</h2>

<h3 id="notes-1">Notes</h3>

<ul>
  <li>
    <p>Any time you encounter the string <code class="language-plaintext highlighter-rouge">malloc(strlen(str));</code> it is almost always sure to be an error, where <code class="language-plaintext highlighter-rouge">malloc(strlen(str)+1);</code> was meant. This is because almost all the other string handling routines include the room needed for the trailing <code class="language-plaintext highlighter-rouge">'\0'</code> terminator, so people get used to not making the special provision for it that strlen needs.</p>
  </li>
  <li>
    <p>The one “l” <code class="language-plaintext highlighter-rouge">NUL</code> ends an ASCII string. The two “l” <code class="language-plaintext highlighter-rouge">NULL</code> points to no thing.</p>
  </li>
  <li>
    <p>In <code class="language-plaintext highlighter-rouge">switch</code> statement, the <code class="language-plaintext highlighter-rouge">default</code> case (if present) can appear anywhere in the list of cases, and will be executed if none of the cases match.</p>
  </li>
  <li>
    <p>All the cases are optional, and any form of statement, including labelled statements, is permitted, means that some errors can’t be detected even by <code class="language-plaintext highlighter-rouge">lint</code>. A hard problem was mistyped <code class="language-plaintext highlighter-rouge">defau1t</code> for the <code class="language-plaintext highlighter-rouge">default</code> label (i.e., mistyped a digit “1” for the letter “l”).</p>
  </li>
  <li>
    <p>Some Symbol Overloading in C:</p>
  </li>
</ul>

<p><code class="language-plaintext highlighter-rouge">static</code>:</p>

<p>Inside a function, retains its value between calls; At the function level, visible only in this file.</p>

<p><code class="language-plaintext highlighter-rouge">extern</code>:</p>

<p>Applied to a function definition, has global scope (and is redundant); Applied to a variable, defined elsewhere.</p>

<p><code class="language-plaintext highlighter-rouge">void</code>:</p>

<p>As the return type of a function, doesn’t return a value; In a pointer declaration, the type of a generic pointer; In a parameter list, takes no parameters.</p>

<h2 id="chapter-3-unscrambling-declarations-in-c">Chapter 3: Unscrambling Declarations in C</h2>

<h3 id="notes-2">Notes</h3>

<ul>
  <li>A declaration involving a pointer and a const has several possible orderings:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>
<p>const int * grape;
int const * grape;
int * const grape_jelly;</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<p>The last of these cases makes the pointer read-only, whereas the other two make the object that it points at read-only; and of course, both the object and what it points at might be constant. Either of the following equivalent declarations will accomplish this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>
<p>const int * const grape_jam;
int const * const grape_jam;</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<ul>
  <li>
    <p>a function returning a pointer to a function is allowed: <code class="language-plaintext highlighter-rouge">int (* fun())()</code></p>

    <p>a function returning a pointer to an array is allowed: <code class="language-plaintext highlighter-rouge">int (* foo())[]</code></p>

    <p>an array holding pointers to functions is allowed: <code class="language-plaintext highlighter-rouge">int (*foo[])()</code></p>

    <p>an array can hold other arrays, so you’ll frequently see <code class="language-plaintext highlighter-rouge">int foo[][]</code></p>
  </li>
  <li>
    <p>The Precedence Rule</p>
  </li>
</ul>

<table style="width:100%">
  <tr>
```
<th colspan="3">The Precedence Rule for Understanding C Declarations</th>
```
  </tr>
  <tr>
```
<th colspan="2">A</th>
<th>Declarations are read by starting with the name and then reading in precedence order.</th>
```
  </tr>
  <tr>
```
<th colspan="2">B</th>
<th>The precedence, from high to low, is:</th>
```
  </tr>
  <tr>
```
<td></td>
<td>B.1</td>
<td>parentheses grouping together parts of a declaration</td>
```
  </tr>
  <tr>
```
<td></td>
<td>B.2</td>
<td>the postfix operators:&lt;/br&gt;parentheses () indicating a function, and&lt;/br&gt; square brackets [] indicating an array.</td>
```
  </tr>
  <tr>
```
<td></td>
<td>B.3</td>
<td>the prefix operator: the asterisk denoting "pointer to".</td>
```
  </tr>
  <tr>
```
<th colspan="2">C</th>
<th>If a const and/or volatile keyword is next to a type specifier (e.g. int, long, etc.) it applies to the type specifier. Otherwise the const and/or volatile keyword applies to the pointer asterisk on its immediate left.</th>
```
  </tr>
</table>

<ul>
  <li>A Example Solving a Declaration Using the Precedence Rule</li>
</ul>

<table style="width:100%">
  <tr>
```
<th colspan="3">char* const *(*next)();</th>
```
  </tr>
  <tr>
```
<th colspan="2">A</th>
<th>First, go to the variable name, "next", and note that it is directly enclosed by parentheses.</th>
```
  </tr>
  <tr>
```
<td></td>
<td>B.1</td>
<td>So we group it with what else is in the parentheses, to get "next is a pointer to...".</td>
```
  </tr>
  <tr>
```
<th colspan="2">B</th>
<th>Then we go outside the parentheses, and have a choice of a prefix asterisk, or a postfix pair of parentheses.</th>
```
  </tr>
  <tr>
```
<td></td>
<td>B.2</td>
<td>Rule B.2 tells us the highest precedence thing is the function parentheses at the right, so we have "next is a pointer to a function returning…"</td>
```
  </tr>
  <tr>
```
<td></td>
<td>B.3</td>
<td>Then process the prefix "*" to get "pointer to".</td>
```
  </tr>
  <tr>
```
<th colspan="2">C</th>
<th>Finally, take the "char * const", as a constant pointer to a character</th>
```
  </tr>
</table>

<p>Then put it all together to read:</p>

<p>“<code class="language-plaintext highlighter-rouge">next</code> is a pointer to a function returning a pointer to a const pointer-to-char”</p>

<ul>
  <li>Another Example: <code class="language-plaintext highlighter-rouge">char *(*c[10])(int **p);</code></li>
</ul>

<p>“<code class="language-plaintext highlighter-rouge">c</code> is an array[0..9] of pointer to a function returning a pointer-to-char”</p>

<h2 id="chapter-4-the-shocking-truth-c-arrays-and-pointers-are-not-the-same">Chapter 4: The Shocking Truth: C Arrays and Pointers Are NOT the Same!</h2>

<h3 id="notes-3">Notes</h3>

<ul>
  <li>
    <p>Defined as array NOT Same AS external declaration as pointer. The pointer variable itself will always be at the same address, but its contents can change to point to many different ints at different times. Each of those different ints can have different values. The array can’t move around to different places. At different times it can be filled with different values, but it always refers to the same n consecutive memory locations.</p>
  </li>
  <li>
    <p>Differences Between Arrays and Pointers</p>
  </li>
</ul>

<table style="width:100%">
   <tr>
```
<th>Pointer</th>
<th>Array</th>
```
  </tr>
  <tr>
   <td>Holds the address of data</td>
   <td>Holds data</td>
  </tr>
  <tr>
```
<td>Data is accessed indirectly, so you first retrieve the
```
contents of the pointer, load that as an address (call it "L"),
then retrieve its contents.
If the pointer has a subscript [i] you instead retrieve the
contents of the location 'i' units past "L"</td>
```
<td>Data is accessed directly, so for a[i] you
```
simply retrieve the contents of the
location i units past a.</td>
  </tr>
  <tr>
   <td>Commonly used for dynamic data structures</td>
   <td>Commonly used for holding a fixed number of elements of the same type of data</td>
  </tr>
  <tr>
   <td>Commonly used with `malloc()`, `free()`</td>
   <td>Implicitly allocated and deallocated</td>
  </tr>
  <tr>
   <td>Typically points to anonymous data</td>
   <td>Is a named variable in its own right</td>
  </tr>
</table>

<ul>
  <li>A string literal created by a pointer initialization is defined as read-only in ANSI C; In contrast to a pointer, an array initialized by a literal string is writable. The individual characters can later be changed.</li>
</ul>

<h3 id="to-be-continued">To be continued…</h3>


                <hr>

                <div class="license">
                    <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
                        <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" />
                    </a>
                    <br />
                    This work is licensed under a 
                    <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
                        Creative Commons Attribution-ShareAlike 4.0 International License
                    </a>.
                </div>

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/blog/notes-from-cpp.html" 
                           data-toggle="tooltip" 
                           data-placement="top" 
                           title="Notes from C Primer Plus / C Primer Plus笔记">
                            &larr; Previous Post
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/blog/notes-from-js-tdg.html" 
                           data-toggle="tooltip" 
                           data-placement="top" 
                           title="Notes from JavaScript:The Definitive Guide / JavaScript权威指南笔记">
                            Next Post &rarr;
                        </a>
                    </li>
                    
                </ul>

                
                <div id="disqus_thread"></div>
                <script>
                    var disqus_config = function () {
                        this.page.url = 'http://localhost:4000/blog/notes-from-ecp.html';
                        this.page.identifier = '/blog/notes-from-ecp';
                        this.page.title = 'Notes from Expert C Programming / C专家编程笔记';
                    };
                    (function() {
                        var d = document, s = d.createElement('script');
                        s.src = 'https://Shongsu.disqus.com/embed.js';
                        s.setAttribute('data-timestamp', +new Date());
                        (d.head || d.body).appendChild(s);
                    })();
                </script>
                <noscript>
                    Please enable JavaScript to view the 
                    <a href="https://disqus.com/?ref_noscript" rel="nofollow">
                        comments powered by Disqus.
                    </a>
                </noscript>
                
            </div>
        </div>
    </div>
</article>

<!-- Anchor.js for heading links -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.1/anchor.min.js" integrity="sha512-nMyycQyP0XWqJq+1qXGmz0JHJ3xVxvn3l8wRjTRsc6yf2l5F3V4FV2cJNVh3y2FjOS1z7sY1X3cV1y2k3BH4l2A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        anchors.options = {
            visible: 'always',
            placement: 'right',
            icon: '#'
        };
        anchors.add('.post-container h1, .post-container h2, .post-container h3, .post-container h4');
    });
</script>
<style>
    @media all and (min-width: 800px) {
        .anchorjs-link {
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top: -0.1em;
        }
    }
</style>

  
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml" aria-label="RSS Feed">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>

                    
                    <li>
                        <a href="https://linkedin.com/in/pengyu-chen-85253886" aria-label="LinkedIn" target="_blank" rel="noopener noreferrer">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    

                    
                    <li>
                        <a href="https://github.com/Shongsu" aria-label="GitHub" target="_blank" rel="noopener noreferrer">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    

                    
                    <li>
                        <a href="https://www.zhihu.com/people/Shongsu" aria-label="Zhihu" target="_blank" rel="noopener noreferrer">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-zhihu fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    

                    
                    <li>
                        <a href="mailto:chinhouu1992@gmail.com" aria-label="Email">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">
                    &copy; 2015&ndash;2026 Pengyu. Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js"></script>

<!-- Syntax Highlighting -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wf8aEkv2Lz/Wz3i6/lmC4i8c1Qebfy3iM8guu1n9aTq7gire0xE/gl0fvJf/dJ1dg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" integrity="sha512-0a4y4Bj2EY2Y4WY4Q0S8pSAH8yiFgp8mF07rxBhFqFMj/4k3R0Af0xfY7s3waR0LfVH2B1cDi0F1EBfYEUhg+yw==" crossorigin="anonymous" referrerpolicy="no-referrer">
<script>
    document.addEventListener('DOMContentLoaded', function() {
        hljs.highlightAll();
    });
</script>


</body>

</html>