<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        
        <title>Cordova-Android Plugin Example / Cordova-Android 插件详解</title>
        
        <link rel="alternate" type="application/rss+xml" title="Pengyu Chen">
        <link rel="shortcut icon" href="/favicon.ico">
        <!-- syntax highlighting css -->
        <link rel="stylesheet" type="text/css" href="/css/syntax.css">
        <!-- homepage css -->
        <link rel="stylesheet" type="text/css" href="/css/hgtip/aal.css">
        <link rel="stylesheet" type="text/css" href="/css/hgtip/calluna.css">
        <link rel="stylesheet" type="text/css" href="/css/hgtip/style.css">
    </head>
    <body>
        <div id="main-wrap">
            <div id="header">
                <h1><a href="/" title="Pengyu Chen">Pengyu Chen</a></h1>
                <br />
            </div>
            <p id="navigation">
                <a href="/pages/archives.html">Archives</a> &mdash;
                <a href="/pages/projects.html">Projects</a> &mdash;
                <a href="/pages/people.html">People</a> &mdash;
                <a href="/pages/favorite.html">Favorite</a> &mdash;
                <a href="/pages/about.html">About</a>
            </p>
            <div id="content">
                
<h2>Cordova-Android Plugin Example / Cordova-Android 插件详解</h2>

<p id="tip-info">October 27, 2015 @ 12:19 AM</p>
<p><center><strong>------English (英文)------</strong></center></p>

<p>This is sample cordova plugin (currently for android platform only). Tested with Cordova 5.3.3 + Android 5.1.1</p>

<p>You can get the original codes from <a href="https://github.com/ShongSu/CordovaPluginExample">here</a>. </p>

<h2>How to run example?</h2>

<p>Create a new cordova project, for example:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">cordova create PluginTest com.shongsu.test PluginTest
</code></pre></div>
<p>Go into the directory you just created.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">cd PluginTest
</code></pre></div>
<p>Add Android platform.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">cordova platform add android
</code></pre></div>
<p>Add this plugin to your cordova project, type:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">cordova plugin add https://github.com/shongsu/cordova-example-plugin.git
</code></pre></div>
<p>or clone this git and add it locally, for example:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">cordova plugin add file-path-here
</code></pre></div>
<p>Eidt your <code>www/index.html</code> file, here is full example:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;!DOCTYPE html&gt;
    &lt;html&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot; /&gt;
        &lt;title&gt;Cordova - Android Plugin Example&lt;/title&gt;

        &lt;script type=&quot;text/javascript&quot; src=&quot;cordova.js&quot;&gt;&lt;/script&gt;
        &lt;script type=&quot;text/javascript&quot; src=&quot;plugins/SamplePlugin.js&quot;&gt;&lt;/script&gt;

        &lt;script type=&quot;text/javascript&quot;&gt;
            function onLoad() {
                document.addEventListener(&#39;deviceready&#39;, onDeviceReady, false);
            }

            function onDeviceReady() {
        var a = 5;
        var b = 3;
                window.func_add(a, b, function(result) { alert(a + &quot; + &quot; + b + &quot; = &quot; + result); }, function(err) { alert(err); });
        window.func_sub(a, b, function(result) { alert(a + &quot; - &quot; + b + &quot; = &quot; + result); }, function(err) { alert(err); });
        window.func_factorial(a, function(result) { alert(a + &quot;! = &quot; + result); }, function(err) { alert(err); });      
      }
        &lt;/script&gt;
    &lt;/head&gt;

    &lt;body onload=&quot;onLoad()&quot;&gt;
        &lt;h1&gt;Cordova - Android Plugin Example&lt;/h1&gt;
    &lt;p&gt;
    1. a+b; &lt;br/&gt;
    2. a-b; &lt;br/&gt;
    3. a!;
    &lt;/p&gt;

    &lt;/body&gt;
&lt;/html&gt;
</code></pre></div>
<p>Run application.</p>

<p>In this example, page shuld alert &quot;5 + 3 = 8&quot;, &quot;5 - 3 = 2&quot; and &quot;5! = 120&quot;.</p>

<h2>How it works?</h2>

<p>We have <strong>three files</strong>: native code (.java), javascript code which exposes native code to cordova box (.js) and plugin manifest file (.xml). The structure looks as</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">    ExamplePlugin
    │  plugin.xml
    │
    ├─src
    │  └─android
    │       ExamplePlugin.java
    │
    └─www
        ExamplePlugin.js
</code></pre></div>
<p><br /></p>

<p>Let&#39;s take a look at plugin files:</p>

<p><code>src/android//ExamplePlugin.java</code> contains native code which executes outside of your cordova box.
<br />
<code>www/ExamplePlugin.js</code> connects native code with javascript - declares javascript functions <code>func_add</code>, <code>func_sub</code> and <code>func_factorial</code>.
<br />
<code>plugin.xml</code> contains info about plugin itself and paths to java and js files.</p>

<h2>ExamplePlugin.java</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">    package com.shongsu.plugin;

    import org.apache.cordova.CordovaPlugin;
    import org.apache.cordova.CallbackContext;
    import org.apache.cordova.PluginResult;

    import org.json.JSONArray;
    import org.json.JSONException;
    import org.json.JSONObject;

    /**
     * This class performs sum called from JavaScript.
     */
    public class ExamplePlugin extends CordovaPlugin {
        @Override
        public boolean execute(String action, JSONArray args, CallbackContext callbackContext) throws JSONException {
            if (action.equals(&quot;func_add&quot;)) {
                Integer num1 = args.getInt(0);
                Integer num2 = args.getInt(1);
                this.func_add(num1, num2, callbackContext);
                return true;
            } else if (action.equals(&quot;func_sub&quot;)) {
                Integer num1 = args.getInt(0);
                Integer num2 = args.getInt(1);
                this.func_sub(num1, num2, callbackContext);
                return true;
            } else if (action.equals(&quot;func_factorial&quot;)) {
                Integer num1 = args.getInt(0);
                this.func_factorial(num1, callbackContext);
                return true;
            }

            return false;
        }

        private void func_add(Integer num1, Integer num2, CallbackContext callbackContext) {
            if(num1 != null &amp;&amp; num2 != null) {
                callbackContext.success(num1 + num2);
            } else {
                callbackContext.error(&quot;Expected two integer arguments.&quot;);
            }
        }

        private void func_sub(Integer num1, Integer num2, CallbackContext callbackContext) {
            if(num1 != null &amp;&amp; num2 != null) {
                int s = num1 - num2;
                callbackContext.success(s);
            } else {
                callbackContext.error(&quot;Expected two integer arguments.&quot;);
            }
        }

        private void func_factorial(Integer num1, CallbackContext callbackContext) {
            if(num1 != null &amp;&amp; num1 &gt;= 0) {
                int result = 1;
                if (num1 == 0 || num1 ==1) {
                  result = 1;
                } else {
                  for(int i=1;i&lt;=num1;i++)
                  {
                    result *= i;
                  }
                }

                callbackContext.success(result);
            } else {
                callbackContext.error(&quot;Expected a non-negative integer argument.&quot;);
            }
        }

    }
</code></pre></div>
<p>First method <code>execute</code> is the same in every plugin, it overrides standard method of CordovaPlugin class and allways has the same parameters:</p>

<ul>
<li>Parameter <code>action</code> is string containing name of method to execute.</li>
<li><code>args</code> is array containing variable number of arguments</li>
<li><code>callbackContext</code> has <code>.success</code> and <code>.error</code> methods which are called when your function finishes or in case of error.</li>
</ul>

<p>Note that our plugin class can have many methods, but just one <code>execute</code> function. We test <code>action</code> argument to see which method we should call.
<br /></p>

<p>Next method <code>func_add</code> is our example function: it receives two integers and callbackContext. In case of error it calls <code>callbackContext.error</code> with error message string, or in case of success it calls <code>callbackContext.success</code> with result.</p>

<p>Same as method <code>func_sub</code> and <code>func_factorial</code>.</p>

<h2>ExamplePlugin.js</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">window.func_add = function(num1, num2, successCallback, errorCallback) {
    cordova.exec(successCallback, errorCallback, &quot;ExamplePlugin&quot;, &quot;func_add&quot;, [num1, num2]);
};

window.func_sub = function(num1, num2, successCallback, errorCallback) {
    cordova.exec(successCallback, errorCallback, &quot;ExamplePlugin&quot;, &quot;func_sub&quot;, [num1, num2]);
};

window.func_factorial = function(num1, successCallback, errorCallback) {
    cordova.exec(successCallback, errorCallback, &quot;ExamplePlugin&quot;, &quot;func_factorial&quot;, [num1]);
};
</code></pre></div>
<p>In this file we extend <code>window</code> object with function <code>func_add</code> (for example) which calls <code>cordova.exec</code>. Cordova translates that and calls <code>execute</code> method from our class declared in ExamplePlugin.java.</p>

<p>Arguments to <code>exec</code> are allways the same: two callback functions (success and error callback), plugin class name, action name and array of arguments.
You can pass any number of arguments - they are processed by execute function as described.</p>

<h2>plugin.xml</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
    &lt;plugin xmlns=&quot;http://apache.org/cordova/ns/plugins/1.0&quot;
        id=&quot;com.shongsu.plugin.ExamplePlugin&quot;
        version=&quot;1.0.0&quot;&gt;

        &lt;name&gt;ExamplePlugin&lt;/name&gt;

      &lt;description&gt;
        Cordova-Android Plugin Example
      &lt;/description&gt;

      &lt;js-module src=&quot;www/ExamplePlugin.js&quot; name=&quot;ExamplePlugin&quot;&gt;
            &lt;clobbers target=&quot;ExamplePlugin&quot; /&gt;
        &lt;/js-module&gt;

      &lt;engines&gt;
        &lt;engine name=&quot;cordova&quot; version=&quot;&gt;=3.0.0&quot; /&gt;
      &lt;/engines&gt;

      &lt;!-- android --&gt;
      &lt;platform name=&quot;android&quot;&gt;
        &lt;config-file target=&quot;res/xml/config.xml&quot; parent=&quot;/*&quot;&gt;
          &lt;feature name=&quot;ExamplePlugin&quot;&gt;
              &lt;param name=&quot;android-package&quot; value=&quot;com.shongsu.plugin.ExamplePlugin&quot;/&gt;
          &lt;/feature&gt;
        &lt;/config-file&gt;

        &lt;source-file src=&quot;src/android/ExamplePlugin.java&quot; target-dir=&quot;src/com/shongsu/plugin/ExamplePlugin&quot; /&gt;
      &lt;/platform&gt;

      &lt;!-- more platforms here --&gt;

    &lt;/plugin&gt;
</code></pre></div>
<p>This file tells cordova how to deal with plugin. Package name, class name and (relative) paths to files are defined here. More details about <a href="https://cordova.apache.org/docs/en/5.1.1/config_ref/index.html">plugin.xml</a>.</p>

<p>For more details refer:</p>

<p><a href="http://docs.phonegap.com/en/3.4.0/guide_hybrid_plugins_index.md.html#Plugin%20Development%20Guide">Cordova Plugin Development Guide</a> and <a href="http://docs.phonegap.com/en/3.4.0/guide_platforms_android_plugin.md.html#Android%20Plugins">Android Plugins</a></p>

<div id="tip-comments">
    <h2>Related Posts</h2>
    <ul>
        
        <li><a href="/2015/11/17/max-subsequence-sum.html">Max Subsequence Sum Problem / 最大子序列和问题</a> &raquo; November 17, 2015</li>
        
        <li><a href="/2015/09/01/codility.html">A Good Site for Coding Test / Codility, 练习编码的好平台</a> &raquo; September  1, 2015</li>
        
        <li><a href="/2015/07/31/get-cell-value-swift.html">Get Value from Cells of TableView / TableView点击获取当前Cell内容</a> &raquo; July 31, 2015</li>
        
    </ul>
</div>

            </div>
            <div id="footer">
                Follow me: <a href="https://github.com/ShongSu">Github</a> / <a href="https://ca.linkedin.com/pub/pengyu-chen/86/538/852">Linkedin</a> 
            </div>
        </div>
    </body>
</html>
